#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>

unsigned char sbox[256];
uint32_t _sbox(uint32_t x) {
  int i = 0;
  int res = 0;
  for (i = 0; i < 4; i++) {
    res |= (sbox[x & 0xff] << 8 * i);
    x = x >> 8;
  }
  return res;
}

int main() {
  uint64_t range = ((uint64_t)1)<<32;
  uint64_t i, j;
  unsigned char sbox_s[16] = {0xf, 0x1, 0x3, 0x9, 0xB, 0x6, 0x2, 0x8,
               0xC, 0x5, 0xE, 0xA, 0x4, 0x0, 0x7, 0xD};

  int ch;
  for (ch = 0; ch < 256; ch++) {
    sbox[ch] = sbox_s[ch & 0xf] | (sbox_s[ch >> 4] << 4);
  }

  uint32_t* dict = malloc(sizeof(uint32_t) * (range));

  if (dict == NULL) {
    printf("fuck\n");
    exit(-1);
  }

//  uint32_t plains[4] = {0x74b4814a, 0x77b78249, 0x76b68348,0x9f5f6aa1};
//  uint32_t ciphers[4] = {0xbb38775a, 0xb9337158, 0xb3377852, 0x244eb2b5};
//  uint32_t plains[4] = {0x74b4814a, 0x77b78249, 0x76b68348, 0x9f5f6aa1};
//  uint32_t ciphers[4] = {0x8babc1be, 0x88a8c3b5, 0x82a2c9bc, 0x5d6d2ee1};
 uint32_t plains[256] = {0x35f5c00b,0x34f4c10a,0x37f7c209,0x36f6c308,0x31f1c40f,0x30f0c50e,0x33f3c60d,0x32f2c70c,0x3dfdc803,0x3cfcc902,0x3fffca01,0x3efecb00,0x39f9cc07,0x38f8cd06,0x3bfbce05,0x3afacf04,0x25e5d01b,0x24e4d11a,0x27e7d219,0x26e6d318,0x21e1d41f,0x20e0d51e,0x23e3d61d,0x22e2d71c,0x2dedd813,0x2cecd912,0x2fefda11,0x2eeedb10,0x29e9dc17,0x28e8dd16,0x2bebde15,0x2aeadf14,0x15d5e02b,0x14d4e12a,0x17d7e229,0x16d6e328,0x11d1e42f,0x10d0e52e,0x13d3e62d,0x12d2e72c,0x1ddde823,0x1cdce922,0x1fdfea21,0x1edeeb20,0x19d9ec27,0x18d8ed26,0x1bdbee25,0x1adaef24,0x5c5f03b,0x4c4f13a,0x7c7f239,0x6c6f338,0x1c1f43f,0xc0f53e,0x3c3f63d,0x2c2f73c,0xdcdf833,0xcccf932,0xfcffa31,0xecefb30,0x9c9fc37,0x8c8fd36,0xbcbfe35,0xacaff34,0x75b5804b,0x74b4814a,0x77b78249,0x76b68348,0x71b1844f,0x70b0854e,0x73b3864d,0x72b2874c,0x7dbd8843,0x7cbc8942,0x7fbf8a41,0x7ebe8b40,0x79b98c47,0x78b88d46,0x7bbb8e45,0x7aba8f44,0x65a5905b,0x64a4915a,0x67a79259,0x66a69358,0x61a1945f,0x60a0955e,0x63a3965d,0x62a2975c,0x6dad9853,0x6cac9952,0x6faf9a51,0x6eae9b50,0x69a99c57,0x68a89d56,0x6bab9e55,0x6aaa9f54,0x5595a06b,0x5494a16a,0x5797a269,0x5696a368,0x5191a46f,0x5090a56e,0x5393a66d,0x5292a76c,0x5d9da863,0x5c9ca962,0x5f9faa61,0x5e9eab60,0x5999ac67,0x5898ad66,0x5b9bae65,0x5a9aaf64,0x4585b07b,0x4484b17a,0x4787b279,0x4686b378,0x4181b47f,0x4080b57e,0x4383b67d,0x4282b77c,0x4d8db873,0x4c8cb972,0x4f8fba71,0x4e8ebb70,0x4989bc77,0x4888bd76,0x4b8bbe75,0x4a8abf74,0xb575408b,0xb474418a,0xb7774289,0xb6764388,0xb171448f,0xb070458e,0xb373468d,0xb272478c,0xbd7d4883,0xbc7c4982,0xbf7f4a81,0xbe7e4b80,0xb9794c87,0xb8784d86,0xbb7b4e85,0xba7a4f84,0xa565509b,0xa464519a,0xa7675299,0xa6665398,0xa161549f,0xa060559e,0xa363569d,0xa262579c,0xad6d5893,0xac6c5992,0xaf6f5a91,0xae6e5b90,0xa9695c97,0xa8685d96,0xab6b5e95,0xaa6a5f94,0x955560ab,0x945461aa,0x975762a9,0x965663a8,0x915164af,0x905065ae,0x935366ad,0x925267ac,0x9d5d68a3,0x9c5c69a2,0x9f5f6aa1,0x9e5e6ba0,0x99596ca7,0x98586da6,0x9b5b6ea5,0x9a5a6fa4,0x854570bb,0x844471ba,0x874772b9,0x864673b8,0x814174bf,0x804075be,0x834376bd,0x824277bc,0x8d4d78b3,0x8c4c79b2,0x8f4f7ab1,0x8e4e7bb0,0x89497cb7,0x88487db6,0x8b4b7eb5,0x8a4a7fb4,0xf53500cb,0xf43401ca,0xf73702c9,0xf63603c8,0xf13104cf,0xf03005ce,0xf33306cd,0xf23207cc,0xfd3d08c3,0xfc3c09c2,0xff3f0ac1,0xfe3e0bc0,0xf9390cc7,0xf8380dc6,0xfb3b0ec5,0xfa3a0fc4,0xe52510db,0xe42411da,0xe72712d9,0xe62613d8,0xe12114df,0xe02015de,0xe32316dd,0xe22217dc,0xed2d18d3,0xec2c19d2,0xef2f1ad1,0xee2e1bd0,0xe9291cd7,0xe8281dd6,0xeb2b1ed5,0xea2a1fd4,0xd51520eb,0xd41421ea,0xd71722e9,0xd61623e8,0xd11124ef,0xd01025ee,0xd31326ed,0xd21227ec,0xdd1d28e3,0xdc1c29e2,0xdf1f2ae1,0xde1e2be0,0xd9192ce7,0xd8182de6,0xdb1b2ee5,0xda1a2fe4,0xc50530fb,0xc40431fa,0xc70732f9,0xc60633f8,0xc10134ff,0xc00035fe,0xc30336fd,0xc20237fc,0xcd0d38f3,0xcc0c39f2,0xcf0f3af1,0xce0e3bf0,0xc9093cf7,0xc8083df6,0xcb0b3ef5,0xca0a3ff4};
    uint32_t ciphers[256] = {0xa52103d4,0xab2807da,0xa92301d8,0xa32708d2,0xa1290ad0,0xac2d00dd,0xa82a09d9,0xa2200dd3,0xa6220ed7,0xaf2c04de,0xa42e02d5,0xa0240cd1,0xae260fdf,0xaa2b05db,0xad2f06dc,0xa7250bd6,0x581d394,0xb88d79a,0x983d198,0x387d892,0x189da90,0xc8dd09d,0x88ad999,0x280dd93,0x682de97,0xf8cd49e,0x48ed295,0x84dc91,0xe86df9f,0xa8bd59b,0xd8fd69c,0x785db96,0x45b1e3e4,0x4bb8e7ea,0x49b3e1e8,0x43b7e8e2,0x41b9eae0,0x4cbde0ed,0x48bae9e9,0x42b0ede3,0x46b2eee7,0x4fbce4ee,0x44bee2e5,0x40b4ece1,0x4eb6efef,0x4abbe5eb,0x4dbfe6ec,0x47b5ebe6,0x95614344,0x9b68474a,0x99634148,0x93674842,0x91694a40,0x9c6d404d,0x986a4949,0x92604d43,0x96624e47,0x9f6c444e,0x946e4245,0x90644c41,0x9e664f4f,0x9a6b454b,0x9d6f464c,0x97654b46,0xb5317354,0xbb38775a,0xb9337158,0xb3377852,0xb1397a50,0xbc3d705d,0xb83a7959,0xb2307d53,0xb6327e57,0xbf3c745e,0xb43e7255,0xb0347c51,0xbe367f5f,0xba3b755b,0xbd3f765c,0xb7357b56,0x159193c4,0x1b9897ca,0x199391c8,0x139798c2,0x11999ac0,0x1c9d90cd,0x189a99c9,0x12909dc3,0x16929ec7,0x1f9c94ce,0x149e92c5,0x10949cc1,0x1e969fcf,0x1a9b95cb,0x1d9f96cc,0x17959bc6,0x35f1f374,0x3bf8f77a,0x39f3f178,0x33f7f872,0x31f9fa70,0x3cfdf07d,0x38faf979,0x32f0fd73,0x36f2fe77,0x3ffcf47e,0x34fef275,0x30f4fc71,0x3ef6ff7f,0x3afbf57b,0x3dfff67c,0x37f5fb76,0xd5115334,0xdb18573a,0xd9135138,0xd3175832,0xd1195a30,0xdc1d503d,0xd81a5939,0xd2105d33,0xd6125e37,0xdf1c543e,0xd41e5235,0xd0145c31,0xde165f3f,0xda1b553b,0xdd1f563c,0xd7155b36,0xf5716324,0xfb78672a,0xf9736128,0xf3776822,0xf1796a20,0xfc7d602d,0xf87a6929,0xf2706d23,0xf6726e27,0xff7c642e,0xf47e6225,0xf0746c21,0xfe766f2f,0xfa7b652b,0xfd7f662c,0xf7756b26,0x55d123f4,0x5bd827fa,0x59d321f8,0x53d728f2,0x51d92af0,0x5cdd20fd,0x58da29f9,0x52d02df3,0x56d22ef7,0x5fdc24fe,0x54de22f5,0x50d42cf1,0x5ed62fff,0x5adb25fb,0x5ddf26fc,0x57d52bf6,0x2541b3b4,0x2b48b7ba,0x2943b1b8,0x2347b8b2,0x2149bab0,0x2c4db0bd,0x284ab9b9,0x2240bdb3,0x2642beb7,0x2f4cb4be,0x244eb2b5,0x2044bcb1,0x2e46bfbf,0x2a4bb5bb,0x2d4fb6bc,0x2745bbb6,0x65011314,0x6b08171a,0x69031118,0x63071812,0x61091a10,0x6c0d101d,0x680a1919,0x62001d13,0x66021e17,0x6f0c141e,0x640e1215,0x60041c11,0x6e061f1f,0x6a0b151b,0x6d0f161c,0x67051b16,0x85e13364,0x8be8376a,0x89e33168,0x83e73862,0x81e93a60,0x8ced306d,0x88ea3969,0x82e03d63,0x86e23e67,0x8fec346e,0x84ee3265,0x80e43c61,0x8ee63f6f,0x8aeb356b,0x8def366c,0x87e53b66,0xc5a1a384,0xcba8a78a,0xc9a3a188,0xc3a7a882,0xc1a9aa80,0xccada08d,0xc8aaa989,0xc2a0ad83,0xc6a2ae87,0xcfaca48e,0xc4aea285,0xc0a4ac81,0xcea6af8f,0xcaaba58b,0xcdafa68c,0xc7a5ab86,0x75c1c3a4,0x7bc8c7aa,0x79c3c1a8,0x73c7c8a2,0x71c9caa0,0x7ccdc0ad,0x78cac9a9,0x72c0cda3,0x76c2cea7,0x7fccc4ae,0x74cec2a5,0x70c4cca1,0x7ec6cfaf,0x7acbc5ab,0x7dcfc6ac,0x77c5cba6,0xe5518304,0xeb58870a,0xe9538108,0xe3578802,0xe1598a00,0xec5d800d,0xe85a8909,0xe2508d03,0xe6528e07,0xef5c840e,0xe45e8205,0xe0548c01,0xee568f0f,0xea5b850b,0xed5f860c,0xe7558b06};
  uint32_t key1, key2;
  key1 = 0;
  key2 = 0;
  for (i = 0; i <range; i++) {
    dict[_sbox(plains[0] ^ i)] = i;
  }
  printf("table finished\n");

  for (i = 0; i < range; i++) {
    key1 = dict[ciphers[0] ^ i];
    key2 = i;

    for (j = 0; j < sizeof(ciphers) / sizeof(uint32_t); j++) {
      if ((_sbox(plains[j] ^ key1) ^ key2) != ciphers[j]) {
        goto fail;
      }
    }

    printf("FOUND : %08X %08X\n", key1, key2);
fail:
    continue;
  }
}
